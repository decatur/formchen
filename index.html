<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Formchen</title>
    <link rel="stylesheet" href="index.css">

</head>

<body>

    <h1>Formchen (little form)</h1>

    <p>
        Extreme lightweight web form generator for hierarchical and grid data supporting undo/redo management.
        See repo <a href="https://github.com/decatur/formchen">https://github.com/decatur/formchen</a> for
        details.
    </p>

    <h2>Basic Example</h2>

    <div id="BasicDemo" class="demo">
        <form class="views">
            <label>Page<input type="radio" name="view" value="page" checked></label><label>Data<input type="radio" name="view" value="data"></label>
            <label>Patch<input type="radio" name="view" value="patch"></label>
            <label>Schema<input type="radio" name="view" value="schema"></label>
            <label>Script<input type="radio" name="view" value="script"></label>
            <code></code>
        </form>

        <div>
            <label><span class="data-title"></span><textarea name="/plant"></textarea></label>
            <label for="/reference"><span class="data-title"></span></label><input id="/reference">
            <label><span class="data-title"></span><select name="/observer"></select></label>
            <label><span class="data-title"></span><input name="/start"></label>
            <label data-path="/latitude"><span class="data-title"></span> <input class="data-value"></label>
            <label><span class="data-title"></span> <input name="/longitude"></label>
            <label><span class="data-title"></span><grid-chen name="/measurements"
                    style="display:block; height:10em"></grid-chen>
            </label>
            <label><span class="data-title"></span> <input name="/isCompleted"></label>
        </div>

        <script type="module">
            import { createFormChen } from "./formchen/formchen.js"
            import * as utils from "./formchen/utils.js";
            import { REPR, bindViews } from "./test/utils.js";

            const schema = {
                definitions: {
                    "measurements": {
                        title: 'Measurements',
                        type: 'array',
                        format: 'grid',
                        items: {
                            type: 'array',  // tuple schema
                            items: [
                                { title: 'TimeStamp', width: 200, type: 'string', format: 'date-time', period: 'HOURS' },
                                { title: 'Age [d]', width: 100, type: 'number' },
                                { title: 'Weight [g]', width: 100, type: 'number' }
                            ]
                        }
                    }
                },
                title: 'BasicDemo',
                type: 'object',
                properties: {
                    plant: {
                        title: 'Plant',
                        description: 'The name of the plant',
                        type: 'string'
                    },
                    reference: {
                        title: 'Reference',
                        type: 'string',
                        format: 'uri'
                    },
                    observer: {
                        title: 'Observer',
                        type: 'string',
                        enum: ['Frida Krum', 'Tilda Swift']
                    },
                    start: {
                        title: 'Started',
                        type: 'string',
                        format: 'date-time'
                    },
                    latitude: {
                        title: 'Latitude',
                        type: 'number',
                        unit: '[DD]',
                        fractionDigits: 5
                    },
                    longitude: {
                        title: 'Longitude',
                        type: 'number',
                        unit: '[DD]',
                        fractionDigits: 5
                    },
                    measurements: {
                        title: 'Daylight Measurements',
                        type: 'array',
                        $ref: '#/definitions/measurements'
                    },
                    isCompleted: {
                        title: 'Is Completed',
                        type: 'boolean'
                    }
                }
            };

            const data = {
                plant: 'Rubus idaeus',
                reference: 'https://en.wikipedia.org/wiki/Rubus_idaeus',
                observer: 'Frida Krum',
                start: '2019-01-01T00:00Z',
                latitude: 41.40338,
                longitude: 2.17403,
                measurements: [
                    ["2019-01-01T00:00Z", 0, 0],
                    ["2019-02-01T00:00Z", 1, 2],
                    ["2019-03-01T00:00Z", 2, 4]
                ],
                isCompleted: true
            };

            const container = document.getElementById(schema.title);
            const tm = new utils.TransactionManager();
            utils.registerUndo(document.body, tm);
            const formchen = createFormChen(container.querySelector('div'), schema, data, tm);
            function value() {
                return formchen.value
            }

            // ==== End Displayed Code ====

            const codeElement = /** @type{HTMLTextAreaElement} **/ (container.querySelector('.views > code'));
            // function refreshEdits() {
            //     editsElement.textContent = REPR.stringify((state === 'patch' ? tm.patch : formchen.value), null, 2);
            // }

            //const srcElement = /** @type{HTMLTextAreaElement} **/ (container.querySelector('.src'));
            // let state = 'hide';
            bindViews(container, schema, value, tm);
            // container.querySelectorAll("input[type='radio']").forEach((/** @type{HTMLInputElement} */ elem) => {
            //     elem.onchange = (ev) => {
            //         const state = elem.value;
            //         if (state == 'page') { 
            //             codeElement.style.display = 'none';
            //             container.querySelector('div').style.display = 'block';
            //         } else {
            //             container.querySelector('div').style.display = 'none';
            //             codeElement.style.display = 'block';
            //             if (state == 'schema') {
            //                 codeElement.textContent = REPR.stringify(schema, null, 2);
            //             } else if (state == 'data') {
            //                 codeElement.textContent = REPR.stringify(formchen.value, null, 2);
            //             } else if (state == 'patch') {
            //                 codeElement.textContent = REPR.stringify(tm.patch, null, 2);
            //             } else if (state == 'script') {
            //                 let script = container.querySelector('script').textContent;
            //                 script = script.split('// ====')[0].replace(new RegExp('\n            ', 'g'), '\n');
            //                 script = script.replace(/schema = ([^;]*)/, 'schema = {...}');
            //                 script = script.replace(/data = ([^;]*)/, 'data = {...}')
            //                 codeElement.textContent = script;
            //             }
                        
            //         }
            //     }
            // })

            // tm.addEventListener('change', function () {
            //     //refreshEdits();
            //     let transaction = tm.transactions.at(-1);
            //     let target = transaction?.target;
            //     if (target) {
            //         target.nextSibling?.remove()
            //         target.insertAdjacentText('afterend', JSON.stringify(transaction.patches, null, 2));
            //     }
            // });

            // const srcElement = /** @type{HTMLTextAreaElement} **/ (container.querySelector('.src'));
            // const script = container.querySelector('script').textContent;
            // srcElement.textContent = script.split('// ====')[0].replace(new RegExp('\n            ', 'g'), '\n');
            // //let schemaString =script.match(/schema = ([^;]*)/)[1];
            // //srcElement.textContent = schemaString.replace(new RegExp('\n            ', 'g'), '\n');

            // //let schemaString =script.match(/schema = ([^;]*)/)[1];
            // srcElement.textContent = REPR.stringify(schema, null, 2);

        </script>
    </div>

    <h2>Comprehensive Example</h2>

    <div id="ComprehensiveDemo">
        <label><span class="data-title"></span> <input name="/someString"></label>
        <label><span class="data-title"></span> <input name="/someURI"></label>
        <label><span class="data-title"></span> <select name="/someEnum"></select></label>
        <label><span class="data-title"></span> <input name="/someDate"></label>
        <label><span class="data-title"></span> <input name="/someDateTime"></label>
        <label><span class="data-title"></span> <input name="/someBoolean"></label>
        <label><span class="data-title"></span> <input name="/someInteger"></label>
        <label><span class="data-title"></span> <input name="/someFloat"></label>
        <label><span class="data-title"></span> <input name="/someColor"></label>
        <label><span class="data-title"></span> <input name="/anObject/someOtherString"></label>
        <div>
            <label class="data-title"></label>
            <grid-chen name="/someMatrix" style="display:block; height:10em"></grid-chen>
        </div>
        <div>
            <label class="data-title"></span></label>
            <grid-chen name="/anEmptyMatrix" style="display:block; height:10em"></grid-chen>
        </div>
        <label><span class="data-title"></span> <input name="/tuple/0"></label>
        <label><span class="data-title"></span> <input name="/tuple/1"></label>
        <label><span class="data-title"></span> <input name="/tuple/2"></label>

        <form class="edits">
            Edits
            <label><input type="radio" name="contact" value="hide" checked>Hide</label>
            <label><input type="radio" name="contact" value="value">Value</label>
            <label><input type="radio" name="contact" value="patch">Patch</label>
            <code></code>
        </form>
    </div>
    <script type="module" src="./demo/comprehensive-demo.js"></script>

    <div id="Array of Row Objects">
        <h2>Array of row objects</h2>
        <code></code>
        <grid-chen style="display:block; height: 10em"></grid-chen>
    </div>
    <script type="module" src="./demo/array_of_row_objects.js"></script>

    <div id="Array of Column Arrays">
        <h2>A tuple (fixed length array) of column arrays</h2>
        <code></code>
        <grid-chen style="display:block; height: 10em"></grid-chen>
    </div>
    <script type="module" src="./demo/array_of_column_arrays.js"></script>

    <div id="Array of Row Tuples">
        <h2>Array of row tuples (fixed length array)</h2>
        <code></code>
        <grid-chen style="display:block; height: 10em"></grid-chen>
    </div>
    <script type="module" src="./demo/array_of_row_arrays.js"></script>

    <div id="demo">
        <h2>Column Order_objects_of_columns</h2>
        <code></code>
        <grid-chen style="display:block; height: 10em"></grid-chen>
    </div>
    <script type="module" src="./demo/column_order_objects_of_columns.js"></script>

    <div id="Column Order">
        <h2>Column Order with Row Objects</h2>
        <code></code>
        <grid-chen style="display:block; height: 10em"></grid-chen>
    </div>
    <script type="module" src="./demo/column_order_row_objects.js"></script>

    <div id="Object of Columns">
        <h2>Object of Columns</h2>
        <code></code>
        <grid-chen style="display:block; height: 10em"></grid-chen>
    </div>
    <script type="module" src="./demo/object_of_columns.js"></script>

    <div id="Single Column Array">
        <h2>a single column array</h2>
        <code></code>
        <grid-chen style="display:block; height: 10em"></grid-chen>
    </div>
    <script type="module" src="./demo/single_column_array.js"></script>

</body>

</html>